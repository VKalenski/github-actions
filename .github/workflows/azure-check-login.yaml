name: Azure check login

on:
  workflow_dispatch:

jobs:
  check-azure:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ•’ Show current date and time
        uses: VKalenski/GitHub-Actions-Templates/.github/actions/show-time@1.0.1
        with:
          format: 'short'

      - name: ðŸ”‘ Set up Azure credentials
        uses: VKalenski/GitHub-Actions-Templates/.github/actions/azure-login@1.0.1
        with:
          azure-client-id: ${{ secrets.AZURE_CLIENT_ID }}
          azure-client-secret: ${{ secrets.AZURE_CLIENT_SECRET }}
          azure-tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          azure-subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: ðŸ”’ Verify identity
        run: az account show

      - name: ðŸ“¡ List running Azure VMs
        run: |
          echo "Fetching running Azure VMs..."
          az vm list --show-details --query "[?powerState=='VM running'].{name:name, resourceGroup:resourceGroup}" --output table

      - name: ðŸ“‚ List Azure storage accounts
        run: |
          echo "Listing Azure storage accounts..."
          az storage account list --query "[].{Name:name, ResourceGroup:resourceGroup}" --output table

      - name: ðŸ§ª Test Azure CLI version and default subscription
        run: |
          az version
          echo "Current subscription:"
          az account show --query "{Name:name, ID:id}" --output table
